# .github/workflows/schedule.yml
#
# GitHub Actions scheduler for reddit-tech-to-x-bot
# Runs the bot 5 times a day based on your subreddit post_times.
#
# IST → UTC conversions:
#   09:00 IST → 03:30 UTC
#   12:00 IST → 06:30 UTC
#   15:00 IST → 09:30 UTC
#   18:00 IST → 12:30 UTC
#   (If adding 5th/extra: adjust accordingly)
#
# This workflow:
#   - checks out the repo
#   - sets up Python 3.11
#   - installs requirements
#   - runs bot.py
#   - logs everything to stdout (view in Actions tab)

name: Scheduled Reddit → X Bot

on:
  schedule:
    - cron: '30 3 * * *'   # 09:00 IST
    - cron: '30 6 * * *'   # 12:00 IST
    - cron: '30 9 * * *'   # 15:00 IST
    - cron: '30 12 * * *'  # 18:00 IST
    - cron: '30 15 * * *'  # optional 5th time (21:00 IST)

  workflow_dispatch:  # manual trigger

jobs:
  run-bot:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Set up Python 3.11
        uses: actions/setup-python@v4
        with:
          python-version: '3.11'

      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt

      - name: Run bot
        env:
          X_API_KEY: ${{ secrets.X_API_KEY }}
          X_API_SECRET: ${{ secrets.X_API_SECRET }}
          X_ACCESS_TOKEN: ${{ secrets.X_ACCESS_TOKEN }}
          X_ACCESS_SECRET: ${{ secrets.X_ACCESS_SECRET }}
          TELEGRAM_BOT_TOKEN: ${{ secrets.TELEGRAM_BOT_TOKEN }}
          TELEGRAM_ADMIN_CHAT_ID: ${{ secrets.TELEGRAM_ADMIN_CHAT_ID }}
        run: |
          python bot.py
